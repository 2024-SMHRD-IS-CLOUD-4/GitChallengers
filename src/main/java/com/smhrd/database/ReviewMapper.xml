<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ReviewMapper">
	<!-- 리뷰 검색 -->
	<select id="search" resultType="Review">
		select * from ch_review where review_title like '%'||#{keyword}||'%'
	</select>
	
	<!-- 리뷰 리스트 가져오기 -->
	<select id="selectAll" resultType="Review">
		select * from ch_review order by review_title
	</select>
	
	<!-- 리뷰 가져오기 -->
	<select id="review" resultType="Review">
		select * from ch_review where review_idx=#{review_idx} order by review_idx desc
	</select>
	
	<!-- 아이디로 리뷰 불러오기 -->
	<select id="reviewList" resultType="Review">
		select * from ch_review where id=#{id} order by review_idx desc
	</select>
	
	<!-- 베스트 리뷰 -->
	<select id="bestReview" resultType="Review">
		select * from ch_review order by (select count(*) from review_heart where review_heart.review_idx=ch_review.review_idx) desc
	</select>
	
	<!-- 리뷰 작성 수 (챌린지 완료 횟수) -->
	<select id="count" resultType="int">
		select count(*) from ch_review where id=#{id}
	</select>
	
	<!-- 리뷰 작성 -->
	<insert id="reviewWrite" parameterType="Review">
		insert into ch_review values (ch_review_seq.nextval, #{id}, #{review_content}, null, #{is_approved}, #{review_heart}, #{review_title})
	</insert>
	
</mapper>